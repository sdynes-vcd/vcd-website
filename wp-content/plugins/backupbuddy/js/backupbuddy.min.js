var pb_backupbuddy_selectdestination;!function(e,t){if("onprogress"in e.ajaxSettings.xhr()){var a=e.ajaxSettings.xhr;e.ajaxSettings.xhr=function(){var e=a.apply(this,arguments);return e instanceof t.XMLHttpRequest&&e.addEventListener("progress",this.progress,!1),e.upload&&e.upload.addEventListener("progress",this.progress,!1),e}}}(jQuery,window),function(c,s){"use strict";var l="stickyTableHeaders",a=0,d={fixedOffset:0,leftOffset:0,marginTop:0,objDocument:document,objHead:"head",objWindow:s,scrollableArea:s,cacheHeaderHeight:!1,zIndex:3};c.fn[l]=function(t){return this.each(function(){var e=c.data(this,"plugin_"+l);e?"string"==typeof t?e[t].apply(e):e.updateOptions(t):"destroy"!==t&&c.data(this,"plugin_"+l,new function(e,t){var u=this;u.$el=c(e),u.el=e,u.id=a++,u.$el.bind("destroyed",c.proxy(u.teardown,u)),u.$clonedHeader=null,u.$originalHeader=null,u.cachedHeaderHeight=null,u.isSticky=!1,u.hasBeenSticky=!1,u.leftOffset=null,u.topOffset=null,u.init=function(){u.setOptions(t),u.$el.each(function(){var e=c(this);e.css("padding",0),u.$originalHeader=c("thead:first",this),u.$clonedHeader=u.$originalHeader.clone(),e.trigger("clonedHeader."+l,[u.$clonedHeader]),u.$clonedHeader.addClass("tableFloatingHeader"),u.$clonedHeader.css({display:"none",opacity:0}),u.$originalHeader.addClass("tableFloatingHeaderOriginal"),u.$originalHeader.after(u.$clonedHeader),u.$printStyle=c('<style type="text/css" media="print">.tableFloatingHeader{display:none !important;}.tableFloatingHeaderOriginal{position:static !important;}</style>'),u.$head.append(u.$printStyle)}),u.$clonedHeader.find("input, select").attr("disabled",!0),u.updateWidth(),u.toggleHeaders(),u.bind()},u.destroy=function(){u.$el.unbind("destroyed",u.teardown),u.teardown()},u.teardown=function(){u.isSticky&&u.$originalHeader.css("position","static"),c.removeData(u.el,"plugin_"+l),u.unbind(),u.$clonedHeader.remove(),u.$originalHeader.removeClass("tableFloatingHeaderOriginal"),u.$originalHeader.css("visibility","visible"),u.$printStyle.remove(),u.el=null,u.$el=null},u.bind=function(){u.$scrollableArea.on("scroll."+l,u.toggleHeaders),u.isWindowScrolling||(u.$window.on("scroll."+l+u.id,u.setPositionValues),u.$window.on("resize."+l+u.id,u.toggleHeaders)),u.$scrollableArea.on("resize."+l,u.toggleHeaders),u.$scrollableArea.on("resize."+l,u.updateWidth)},u.unbind=function(){u.$scrollableArea.off("."+l,u.toggleHeaders),u.isWindowScrolling||(u.$window.off("."+l+u.id,u.setPositionValues),u.$window.off("."+l+u.id,u.toggleHeaders)),u.$scrollableArea.off("."+l,u.updateWidth)},u.debounce=function(a,d){var n=null;return function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){a.apply(e,t)},d)}},u.toggleHeaders=u.debounce(function(){u.$el&&u.$el.each(function(){var e,t,a,d=c(this),n=u.isWindowScrolling?isNaN(u.options.fixedOffset)?u.options.fixedOffset.outerHeight():u.options.fixedOffset:u.$scrollableArea.offset().top+(isNaN(u.options.fixedOffset)?0:u.options.fixedOffset),i=d.offset(),r=u.$scrollableArea.scrollTop()+n,o=u.$scrollableArea.scrollLeft(),s=u.isWindowScrolling?r>i.top:n>i.top;s&&(t=u.options.cacheHeaderHeight?u.cachedHeaderHeight:u.$clonedHeader.height(),a=(u.isWindowScrolling?r:0)<i.top+d.height()-t-(u.isWindowScrolling?0:n)),s&&a?(e=i.left-o+u.options.leftOffset,u.$originalHeader.css({position:"fixed","margin-top":u.options.marginTop,top:0,left:e,"z-index":u.options.zIndex}),u.leftOffset=e,u.topOffset=n,u.$clonedHeader.css("display",""),u.isSticky||(u.isSticky=!0,u.updateWidth(),d.trigger("enabledStickiness."+l)),u.setPositionValues()):u.isSticky&&(u.$originalHeader.css("position","static"),u.$clonedHeader.css("display","none"),u.isSticky=!1,u.resetWidth(c("td,th",u.$clonedHeader),c("td,th",u.$originalHeader)),d.trigger("disabledStickiness."+l))})},0),u.setPositionValues=u.debounce(function(){var e=u.$window.scrollTop(),t=u.$window.scrollLeft();!u.isSticky||e<0||e+u.$window.height()>u.$document.height()||t<0||t+u.$window.width()>u.$document.width()||u.$originalHeader.css({top:u.topOffset-(u.isWindowScrolling?0:e),left:u.leftOffset-(u.isWindowScrolling?0:t)})},0),u.updateWidth=u.debounce(function(){if(u.isSticky){u.$originalHeaderCells||(u.$originalHeaderCells=c("th,td",u.$originalHeader)),u.$clonedHeaderCells||(u.$clonedHeaderCells=c("th,td",u.$clonedHeader));var e=u.getWidth(u.$clonedHeaderCells);u.setWidth(e,u.$clonedHeaderCells,u.$originalHeaderCells),u.$originalHeader.css("width",u.$clonedHeader.width()),u.options.cacheHeaderHeight&&(u.cachedHeaderHeight=u.$clonedHeader.height())}},0),u.getWidth=function(e){var o=[];return e.each(function(e){var t,a=c(this);if("border-box"===a.css("box-sizing")){var d=a[0].getBoundingClientRect();t=d.width?d.width:d.right-d.left}else if("collapse"===c("th",u.$originalHeader).css("border-collapse"))if(s.getComputedStyle)t=parseFloat(s.getComputedStyle(this,null).width);else{var n=parseFloat(a.css("padding-left")),i=parseFloat(a.css("padding-right")),r=parseFloat(a.css("border-width"));t=a.outerWidth()-n-i-r}else t=a.width();o[e]=t}),o},u.setWidth=function(a,e,d){e.each(function(e){var t=a[e];d.eq(e).css({"min-width":t,"max-width":t})})},u.resetWidth=function(e,a){e.each(function(e){var t=c(this);a.eq(e).css({"min-width":t.css("min-width"),"max-width":t.css("max-width")})})},u.setOptions=function(e){u.options=c.extend({},d,e),u.$window=c(u.options.objWindow),u.$head=c(u.options.objHead),u.$document=c(u.options.objDocument),u.$scrollableArea=c(u.options.scrollableArea),u.isWindowScrolling=u.$scrollableArea[0]===u.$window[0]},u.updateOptions=function(e){u.setOptions(e),u.unbind(),u.bind(),u.updateWidth(),u.toggleHeaders()},u.init()}(this,t))})}}(jQuery,window),(BackupBuddy=window.BackupBuddy||{}).Backups=function(r){"use strict";var e=function(){r(".pb_backupbuddy_hoveraction_send").on("click",function(e){return e.preventDefault(),tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data="+r(this).attr("rel")+"&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null),!1}),r("a.remote-send").off("click").on("click",function(e){e.preventDefault();var t=r(this).attr("data-backup-zip");return tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data="+t+"&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null),!1})},t=function(){r(".backup-actions").off("click").on("click",function(e){e.preventDefault(),r(".backup-actions-menu.open").removeClass("open"),r(".backup-actions.active").not(r(this)).removeClass("active"),r(this).hasClass("active")?(r(this).removeClass("active"),r(this).blur()):(r(this).addClass("active"),r(this).next(".backup-actions-menu").addClass("open"))}),r(document).on("mouseup",function(e){if(r(e.target).hasClass("backup-actions"))return!0;r(".backup-actions-menu").removeClass("open"),r(".backup-actions.active").removeClass("active"),r(".backup-actions").blur()})},a=function(){r(".pb_backupbuddy_hoveraction_hash").on("click",function(e){return e.preventDefault(),tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.hash")+"&callback_data="+r(this).attr("rel")+"&TB_iframe=1&width=640&height=455",null),!1})},d=function(){r(".pb_backupbuddy_hoveraction_note").on("click",function(e){e.preventDefault();var t=r(this).parents("td").find(".pb_backupbuddy_notetext").text();return""==t&&(t="My first backup"),BackupBuddy.Modal.open({mode:"prompt",title:"Backup Note",content:BackupBuddy.Vars.get("strings.note_instructions"),prompt_default:t,prompt:function(e){if(null==e||""==e)return!1;r(".pb_backupbuddy_backuplist_loading").show(),r.post(BackupBuddy.Vars.get("ajax.set_backup_note"),{backup_file:r(this).attr("rel"),note:e},function(e){e=r.trim(e),r(".pb_backupbuddy_backuplist_loading").hide(),"1"!=e&&BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.error")+": "+e}),location.reload(!0)})}}),!1})},n=function(){r(".profile_item_cancel_add_select").off("click").on("click",function(e){e.preventDefault(),r("#pb_backupbuddy_profileadd").hide(),r("#pb_backupbuddy_profileadd_plusbutton").show()})},o=function(){r('a[href$="#backup-details"]').off("click").on("click",function(e){e.preventDefault();var t=r("<span />").addClass("spinner").css("float","none").css("visibility","visible").css("margin-top","-1px"),a=r("<div />").addClass("backupbuddy-backup-details loading").append(t).append("Loading..."),d=r(this).attr("data-backup-zip"),n=r(this).attr("data-destination-id");BackupBuddy.Modal.open({title:"Backup Details",content:a}),r.ajax({url:BackupBuddy.Vars.get("ajax.backup_info"),data:{backup:d,destination:n,return:"html"},success:function(e){if(a.removeClass("loading"),e.success)a.html(e.html);else{var t=void 0===e.error?"Could not retrieve backup detail.":e.error;a.addClass("failed").html(t)}}})})},i=function(){var e=r(".backupbuddy-tabs .restore-backup");if(e.length&&!r("#backupbuddy-data-browser").length&&!r("#backupbuddy-restore-status").hasClass("open")){var t=BackupBuddy.Vars.get("destination_ids");if(t.length&&!e.data("remote-loaded")){e.data("remote-loaded",!0);for(var n=[],a=0;a<t.length;a++)n[a]=!0;var i=[];r(".restore-backups-table tbody tr:not(.hidden)").each(function(){i[i.length]=r(this).attr("data-id")}),s(n);for(var d=0;d<t.length;d++)r.ajax({url:BackupBuddy.Vars.get("ajax.remote_backups"),data:{mode:"restore",destination_id:t[d],index:d},success:function(e){if(e.success&&e.backups.length){var t,a=!!r(".restore-backups-table table").length;for(t=0;t<e.backups.length;t++)if(!1!==a||void 0===e.backups[t].restore){r(e.backups[t].restore).find("tbody tr").each(function(){var e=r(this),t=e.data("id");if(0<=r.inArray(t,i))e.addClass("hidden");else{i[i.length]=t;var a=parseInt(e.attr("data-timestamp")),d=r(".restore-backups-table tbody tr").filter(function(){return parseInt(r(this).attr("data-timestamp"))<=a}).first();d.length?d.before(e):r(".restore-backups-table tbody").append(e)}})}else{var d=r(".restore-backups-table");d.length||(d=r("<div />").addClass("restore-backups-table"),r("#backupbuddy-restore-status").length?r("#backupbuddy-restore-status").after(d):r("#restore-backup").prepend(d)),r("#restore-backup .no-backups-created").remove(),d.html(e.backups[t].restore),a=!0}o(),BackupBuddy.Restore.bind_restore_buttons()}r("#restore-backup th.stash-traditional-backup-files").length&&r("#restore-backup th.stash-traditional-backup-files:first").html(r("#restore-backup th.stash-traditional-backup-files:first").html().replace(BackupBuddy.Vars.get("strings.stash_table_header"),BackupBuddy.Vars.get("strings.backups_table_header"))),n[e.index]=!1,s(n),c()}})}}},s=function(e){for(var t=!1,a=r(".backupbuddy-tabs .restore-backup"),d=0;d<e.length;d++)if(e[d]){t=!0;break}t?a.length&&a.addClass("processing"):a.removeClass("processing")},u=function(){var a=r(".backupbuddy-generate-dat");if(a.length){var d=a.data("zip");d&&r.ajax({url:BackupBuddy.Vars.get("ajax.create-dat"),data:{zip_file:d},success:function(e){if(e.success){var t=BackupBuddy.Vars.get("page_url");t+="&dat_viewer="+encodeURI(d),t+="&value="+encodeURI(d),window.location.href=t}else a.hide(),r(".legacy-file-restore-wrapper").show(),backupbuddy_legacy_file_browser()}})}},c=function(){for(var e=["#backups-main table.minimal",".restore-backups-table",".bb-iframe-divpadding-noscroll table.minimal"],t=0;t<e.length;t++){r(e[t]+" .separator").removeClass("separator"),r(e[t]+" .begin-month").removeClass("begin-month");var a="",d=0;r(e[t]+" tbody tr").each(function(e){var t=r(this).attr("class").split(" ").filter(function(e){return-1<e.indexOf("month-")});t[0]!==a?(a=t[0],(d=0)!==e&&r(this).addClass("begin-month")):d++,5===d&&(d=0,r(this).addClass("separator"))})}};return pb_backupbuddy_selectdestination=function(e,t,a,d,n){if(""!=a&&"delayed_send"!=a){if("importbuddy.php"===a){var i=r('<div id="pb_backupbuddy_ib_sent" class="pb_backupbuddy_alert updated fade">'+BackupBuddy.Vars.get("strings.sending_importbuddy")+"</div>");return r("h1:first").after(i),r.ajax({url:BackupBuddy.Vars.get("ajax.send_importbuddy"),data:{destination_id:e,destination_title:t,callback_data:a},success:function(e){(i=r("#pb_backupbuddy_ib_sent")).html(e.notice),e.success||i.removeClass("updated").addClass("error")}}),!1}r.post(BackupBuddy.Vars.get("ajax.remote_send"),{destination_id:e,destination_title:t,file:a,trigger:"manual",delete_after:d},function(e){if("1"!=(e=r.trim(e)).charAt(0))BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.remote_send_error")+":\n\n"+e});else{var t=" "+BackupBuddy.Vars.get("strings.local_delete_upon_success");d||(t=""),BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.remote_send_confirmed")+t+"\n\n"+e.slice(1)}),r.post(BackupBuddy.Vars.get("ajax_base"))}})}else"delayed_send"==a?(r("#pb_backupbuddy_backup_remotedestination").val(e),r("#pb_backupbuddy_backup_deleteafter").val(d),r("#pb_backupbuddy_backup_remotetitle").html('Destination: "'+t+'".')):window.location.href=BackupBuddy.Vars.get("admin_url")+"?page=pb_backupbuddy_backup&custom=remoteclient&destination_id="+e},{init:function(){e(),a(),d(),n(),o(),t(),i(),u(),c()},cleanup:function(e,t){r.ajax({url:BackupBuddy.Vars.get("ajax.cleanup"),data:{rel:e},success:function(e){e.success?r('div[rel="'+t+'"]').fadeOut("fast",function(){r(this).remove()}):r('div[rel="'+t+'"] .button-actions').addClass("error").html(e.error)}})}}}(jQuery),jQuery(window).on("load",BackupBuddy.Backups.init);var BackupBuddy=window.BackupBuddy||{},MutationObserver=window.MutationObserver||window.WebKitMutationObserver;BackupBuddy.Core=function(p){"use strict";function a(){p(".backupbuddy-admin-notices").is(":empty")&&(p(".backupbuddy-admin-notices").remove(),p(".backupbuddy-admin-notices-toggle").remove())}function t(){p(".backupbuddy-internal-notices").is(":empty")&&p(".backupbuddy-internal-notices").remove()}var e=function(){var e=new MutationObserver(d),t=p(".backupbuddy-admin-page #wpcontent").first();t.length&&(d(),e.observe(t[0],{childList:!0,subtree:!0}))},d=function(){var e=p(".backupbuddy-admin-page #wpbody-content > #dolly"),t=p(".backupbuddy-admin-page #wpcontent > *").first().nextUntil(".backupbuddy-admin-page #wpbody"),a=p(".backupbuddy-admin-page #wpbody-content > *").first().nextUntil(".backupbuddy-admin-page #wpbody-content > .wrap:first"),d=p(".backupbuddy-admin-page #wpbody-content > .wrap > *").first(),n="h1"===d.prop("tagName").toLowerCase()?p():d.nextUntil(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first"),i=p(".backupbuddy-admin-page .backupbuddy-tabs").length?".backupbuddy-admin-page .backupbuddy-tabs":p(".backupbuddy-admin-page .backupbuddy_api_key-hide").length?".backupbuddy-admin-page .backupbuddy_api_key-hide":!!p(".backupbuddy-admin-page .bb_progress-bar").length&&".backupbuddy-admin-page .bb_progress-bar",r=i?p(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first").nextUntil(i):p(),o=t.add(a).add(n).add(r).filter(":not( .bb-topbar-title, .backupbuddy-admin-notices, script, link, .clear, #wpbody, #wpadminbar, #screen-meta, #screen-meta-links, .backupbuddy_api_key-hide, #dolly, :empty, .bub-notice-moved )"),s=o.filter(':not( [class*="backupbuddy"] )').filter(":visible"),u=o.filter('[class*="backupbuddy"]').filter(":visible");if(e.length&&e.css("padding-top","0").css("padding-right","25px").appendTo(".bb-topbar-title"),s.length||u.length){if(s.length){var c=f();if(!c.length)return void console.error("There was a problem initializing BackupBuddy Admin Notices.");s.each(function(){var e=p(this);e.addClass("bub-notice-moved"),e.html()&&!p.contains(c,e)&&c.append(e)}),p(".backupbuddy-admin-notices-toggle .count").html(c.children().length)}if(u.length){var l=b();if(!l.length)return void console.error("There was a problem initializing BackupBuddy Notices.");u.each(function(){l.append(p(this)),p(this).addClass("bub-notice-moved")})}}},b=function(){var e=p(".backupbuddy-internal-notices");e.length||(e=p("<div />").addClass("backupbuddy-internal-notices"),p(".backupbuddy-tabs .tab-controls").length?p(".backupbuddy-tabs .tab-controls").after(e):p(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first").after(e),new MutationObserver(t).observe(e[0],{childList:!0,subtree:!0}));return e},f=function(){var t=p(".backupbuddy-admin-notices"),e=p(".backupbuddy-admin-notices-toggle");t.length||(t=p("<div />").addClass("backupbuddy-admin-notices"),p(".backupbuddy-tabs .tab-controls").length?p(".backupbuddy-tabs .tab-controls").after(t):p(".backupbuddy-admin-page #wpbody-content > .wrap > h1:first").after(t),new MutationObserver(a).observe(t[0],{childList:!0,subtree:!0}));return e.length||(p("#screen-meta-links").append('<div class="backupbuddy-meta-link-wrap hide-if-no-js backupbuddy-admin-notices-toggle"><a href="#admin-notices" class="button show-settings"><span class="count"></span>'+BackupBuddy.Vars.get("strings.admin_notices")+"</a></div>"),(e=p(".backupbuddy-admin-notices-toggle")).on("click",function(e){e.preventDefault(),p(this).find("a:first").toggleClass("screen-meta-active"),t.toggleClass("open")})),t},n=function(){BackupBuddy.Vars.get("hide_quick_setup")||p("#screen-meta-links").append('<div class="backupbuddy-meta-link-wrap hide-if-no-js screen-meta-toggle"><a href="?page=pb_backupbuddy_backup&wizard=1" class="show-settings no-dropdown">'+BackupBuddy.Vars.get("strings.quick_setup")+"</a></div>")},i=function(){var e=p("<a />").attr("href","#importbuddy").addClass("show-settings").text(BackupBuddy.Vars.get("strings.importbuddy")),t=p("<div/>").addClass("backupbuddy-meta-link-wrap hide-if-no-js screen-meta-toggle"),a=p("<div />").addClass("hover-menu"),d=p("<a />").addClass("download-importbuddy").attr("href",BackupBuddy.Vars.get("ajax.importbuddy")).text(BackupBuddy.Vars.get("strings.importbuddy_download")),n=p("<a />").addClass("send-importbuddy").attr("href",BackupBuddy.Vars.get("ajax.destination_picker")).text(BackupBuddy.Vars.get("strings.importbuddy_send")).attr("rel","importbuddy.php");e.on("click",function(e){e.preventDefault()}),d.on("click",function(e){e.preventDefault();var a=p(this).attr("href");return BackupBuddy.Vars.get("importbuddy_pass_set")?BackupBuddy.Modal.open({mode:"prompt",title:"ImportBuddy Password",content:BackupBuddy.Vars.get("strings.importbuddy_prompt_haspass"),prompt:function(e){var t=a;null!=e&&""!=e&&(t+="&p="+encodeURIComponent(e)),window.location.href=t}}):BackupBuddy.Modal.open({mode:"prompt",title:"ImportBuddy Password",content:BackupBuddy.Vars.get("strings.importbuddy_prompt_nopass"),prompt:function(e){null==e||""==e?""==e&&BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.importbuddy_no_password")}):window.location.href=a+"&p="+encodeURIComponent(e)}}),!1}),n.on("click",function(e){if(e.preventDefault(),!BackupBuddy.Vars.get("importbuddy_pass_set"))return BackupBuddy.Modal.open({mode:"alert",content:"You must set an ImportBuddy password via the BackupBuddy settings page before you can send this file."}),!1;var t=p(this).attr("href"),a=p(this).attr("rel");return a&&("importbuddy.php"!==a&&(t+="&action_verb=to%20send%20to"),t+="&callback_data="+a),t+="&sending=1&TB_iframe=1&width=640&height=455",tb_show("BackupBuddy",t,null),!1}),a.append(d).append(n),e.append(a),t.append(e),p("#screen-meta-links").append(t)};return{init:function(){p("body").hasClass("toplevel_page_pb_backupbuddy_backup")&&(n(),i()),e()},init_observers:e}}(jQuery),jQuery(window).on("load",BackupBuddy.Core.init);BackupBuddy=window.BackupBuddy||{},MutationObserver=window.MutationObserver||window.WebKitMutationObserver;BackupBuddy.Destinations=function(r){"use strict";var a=0,d=0,e=function(){t(),n()},t=function(){var e=new MutationObserver(o),t=r("#pb_backupbuddy_iframe-dest-wrap").first(),a=r("body.destination-tabs"),d=r(".bb-iframe-divpadding-noscroll");if(t.length||a.length||d.length){var n=t.length?t[0]:a.length?a[0]:d[0],i={childList:!0,subtree:!0};d.length&&(i.attributes=!0),o(),e.observe(n,i)}},n=function(){var e=new MutationObserver(i),t=r(".tab-contents.active iframe.backupbuddy-destination-iframe").first(),a=r("body.backupbuddy-admin-iframe");if(t.length||a.length){var d=t.length?t[0]:a[0];i(),e.observe(d,{childList:!0,subtree:!0})}},o=function(){var e=!1;if(e=r("#pb_backupbuddy_iframe-dest-wrap").length?r("#pb_backupbuddy_iframe-dest-wrap")[0]:window.parent.document.getElementById("pb_backupbuddy_iframe-dest-wrap")){e.removeAttribute("style");var t=e.contentWindow.document.documentElement.scrollHeight;r(".bb-iframe-divpadding-noscroll").length&&(t+=50),e.style.height=t+"px",a!==t&&(a=t)}},i=function(){var e=!1;if(e=r(".tab-contents.active iframe.backupbuddy-destination-iframe").length?r(".tab-contents.active iframe.backupbuddy-destination-iframe").first()[0]:window.parent.document.getElementById("pb_backupbuddy_iframe-dest-wrap")){e.removeAttribute("style");var t=e.contentWindow.document.documentElement.scrollHeight;t+=50,e.style.height=t+"px",d!==t&&(d=t)}};return{init:function(){e(),r(window).on("backupbuddy.tabs.switch",function(){o(),i()})},tabsIframeLoad:function(){r(".backupbuddy_destinations_iframe_load").fadeOut("fast"),o()},resizeDestIframe:i}}(jQuery),jQuery(window).on("load",BackupBuddy.Destinations.init),(BackupBuddy=window.BackupBuddy||{}).Diagnostics=function(d){"use strict";var a="backupbuddy_page_pb_backupbuddy_diagnostics",e=function(){d('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#extraneous-log"]').off("click").on("click",function(e){e.preventDefault(),d("#backupbuddy-extra-log").slideToggle("fast"),d("#backupbuddy_logFile").attr("data-loaded")||n()}),d('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#remoteapi-log"]').off("click").on("click",function(e){e.preventDefault(),d("#backupbuddy-remoteapi-log").slideToggle("fast"),d("#backupbuddy_remoteapi_logFile").attr("data-loaded")||i()}),d('.backupbuddy_page_pb_backupbuddy_diagnostics a[href="#hide"]').off("click").on("click",function(e){e.preventDefault();var t=d(this).data("log");"main"===t?d("#backupbuddy-extra-log").slideToggle("fast"):"remote"===t&&d("#backupbuddy-remoteapi-log").slideToggle("fast")})},t=function(){d(document).on("backupbuddy.tabs.switch",function(e,t){d("body").hasClass(a)})},n=function(e){e=void 0===e?0:e,d("#backupbuddy_logFile").length&&d.post(BackupBuddy.Vars.get("ajax.getMainLog"),{confirmed:e},function(e){"string"!=typeof e?confirm("WARNING: Log file is very large ("+e.size+"). This could take a while to load. Are you sure you want to continue?")?n(1):d("#backupbuddy-extra-log").slideToggle("fast"):d("#backupbuddy_logFile").text(e).attr("data-loaded","true")})},i=function(e){e=void 0===e?0:e,d("#backupbuddy_remoteapi_logFile").length&&d.post(BackupBuddy.Vars.get("ajax.getRemoteApiLog"),{confirmed:e},function(e){"string"!=typeof e?confirm("WARNING: Log file is very large ("+e.size+"). This could take a while to load. Are you sure you want to continue?")?i(1):d("#backupbuddy-remoteapi-log").slideToggle("fast"):d("#backupbuddy_remoteapi_logFile").text(e).attr("data-loaded","true")})},r=function(){d('a[href="#reset-log"]').off("click").on("click",function(e){if(e.preventDefault(),!confirm("Are you sure you want to reset this log?"))return!1;var t=d(this).data("log");!function(e,t,a){d.post(BackupBuddy.Vars.get("ajax.reset_log"),{log:e},function(e){e.success&&t?t():(e.error&&BackupBuddy.Modal.open({mode:"alert",content:e.error}),a&&a())})}(t,function(){d('textarea[data-log-file="'+t+'"]').text("-- Log Reset --"),"main"===t?d("#backupbuddy_logFile").removeAttr("data-loaded"):"remote"===t&&d("#backupbuddy_remoteapi_logFile").removeAttr("data-loaded")})})};return{init:function(){e(),t(),r()},load_logs:function(){n(),i()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Diagnostics.init),(BackupBuddy=window.BackupBuddy||{}).File_Viewer=function(r){"use strict";var e=function(){r(document).on("backupbuddy.modal.close",function(){r(".backupbuddy-file-viewer .CodeMirror").remove(),r(".backupbuddy-file-viewer .file-contents").remove(),r(".backupbuddy-file-viewer .file-preview").remove()})},t=function(){r("a.view-file").off("click").on("click",function(e){e.preventDefault();var t=r(this);!function(e,t,a,d){var n=r("<div />").addClass("backupbuddy-file-viewer").addClass("mode-"+a);if("code"===a){var i=r("<textarea />").addClass("file-contents loading").val("Loading...").attr("readonly","readonly");n.append(i),i=n.find(".file-contents")}else{i=r("<div />").addClass("file-preview loading").html("Loading...");n.append(i),i=n.find(".file-preview")}BackupBuddy.Modal.open({content:n,title:t}),r.ajax({url:BackupBuddy.Vars.get("ajax.get_file"),data:{backup:e,path:t,mode:a,type:d},success:function(e){if(void 0!==e.warning){r("<div />").addClass("warning").html(e.warning);console.log(e.warning)}if(e.success)if(i.removeClass("loading"),"code"===a){i.val(e.contents),BackupBuddy.Modal.set_size("max");var t=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};t.codemirror=_.extend({},t.codemirror,{indentUnit:1,tabSize:4,mode:e.mode,indentWithTabs:!0,readOnly:!0});wp.codeEditor.initialize(i,t)}else BackupBuddy.Modal.content(e.contents);else if(void 0!==e.error){r("<div />").addClass("error").html(e.error);console.log(e.error),n.hide()}}})}(r("#backupbuddy-data-browser form").attr("data-zip"),t.attr("data-path"),t.attr("data-mode"),t.attr("data-type"))})};return{init:function(){t(),e()}}}(jQuery),jQuery(window).on("load",BackupBuddy.File_Viewer.init),(BackupBuddy=window.BackupBuddy||{}).FileTree=function(c){"use strict";function l(e){var t=c("<span/>").addClass("spinner");e.append(t)}function p(e){return e.find(".spinner").length}function b(e){e.find(".spinner").remove()}function f(e){var t=e.attr("href").replace("#","");e.toggleClass("open"),e.hasClass("open")?c('tr[data-parent-id="'+t+'"].hidden').removeClass("hidden"):(c('tr[data-parent-id^="'+t+'"]:not(.hidden)').addClass("hidden"),c('tr[data-parent-id^="'+t+'"] a.folder-toggle.open').removeClass("open"))}function k(e,t){e.toggleClass("open"),t.toggleClass("expanded"),t.find("ul:first").toggleClass("open")}function y(e,t){t=void 0===t?250:t,setTimeout(function(){c(".backupbuddy-file-tree").css("height",e.outerHeight(!0))},t)}var g=function(e){return c('.panel[data-path="'+e+'"]').length},h=function(e,t){var a=c('.panel[data-path="'+e+'"]'),d=c(".panel.active");if(t=void 0===t?"forward":"back",a.length&&d.length){a.addClass("instant");"forward"===t?setTimeout(function(){a.removeClass("inactive").addClass("next"),setTimeout(function(){a.removeClass("instant"),setTimeout(function(){d.addClass("inactive").removeClass("active"),a.addClass("active").removeClass("next")},5)},5)},5):setTimeout(function(){a.removeClass("next").addClass("inactive"),setTimeout(function(){a.removeClass("instant"),setTimeout(function(){d.addClass("next").removeClass("active"),a.addClass("active").removeClass("inactive")},5)},5)},5),y(a,265)}},m=function(e,n,i){var t=c("#backupbuddy-file-tree"),a=c("#backupbuddy-data-browser > form"),d=!!a.attr("data-zip")&&a.attr("data-zip"),r=!!a.attr("data-serial")&&a.attr("data-serial"),o=c('input[name="backupbuddy_restore_destination"]').val(),s=t.hasClass("panels"),u=void 0===n?"inside":"after";d&&r&&(e=void 0===e?"__root__":e,n=void 0===n?t:n,s&&(u="append",n=t),c.ajax({url:BackupBuddy.Vars.get("ajax.file_tree"),data:{dat_viewer:d,path:e,serial:r,destination:o},success:function(e){if("inside"===u)n.html(e);else if("after"===u)n.after(e);else if("append"===u){var t=".panel.incoming",a=240;n.hasClass("loading")&&(n.html(""),t=".panel",a=10),n.find(".panel.active").addClass("inactive").removeClass("active"),n.append(e);var d=n.find(t);setTimeout(function(){d.addClass("active").removeClass("incoming")},5),y(d,a)}n.removeClass("loading"),c('.backupbuddy-file-tree a.folder-toggle:not([data-bound="true"])').each(function(){var i=c(this),r=c(".backupbuddy-file-tree table").length?"table":"list";i.attr("data-bound","true"),i.on("click",function(e){if(e.preventDefault(),!i.hasClass("disabled")){var t=i.attr("href").replace("#","");if(g(t))h(t);else if("list"==r){var a=i.parents("li:first"),d=i.parent("div");if(p(d))return;a.find("ul:first").length?k(i,a):(l(d),m(a.attr("data-dir"),d,function(){k(i,a),b(d)}))}else{if(p(i))return;if(c('tr[data-parent-id="'+t+'"]').length)f(i);else{var n=i.parents("tr:first");l(i),m(n.attr("data-dir"),n,function(){f(i),b(i)})}}}})}),c('.backupbuddy-file-tree a.breadcrumb:not([data-bound="true"])').each(function(){var a=c(this);a.attr("data-bound","true"),a.on("click",function(e){if(e.preventDefault(),!a.hasClass("disabled")){var t=a.attr("href").replace("#","");g(t)&&h(t,"back")}})}),1===c("ul#tree_root > li").length?c("ul#tree_root > li > a.folder-toggle").trigger("click"):1===c("table#tree_root tbody tr").length&&c("table#tree_root tbody tr a.folder-toggle").trigger("click"),c('.backupbuddy-file-tree input[type="checkbox"]:not([data-toggler-bound="true"])').each(function(){var d=c(this),n=c(".backupbuddy-file-tree > table").length?"table":"list";d.attr("data-toggler-bound","true"),d.on("change",function(){if("list"==n)d.parents("li:first").find('ul:first input[type="checkbox"]'),d.parents("li:first").parent("ul").parent("li").find('input[type="checkbox"]:first');else{var e=d.parents("tr:first"),t=e.attr("id")?e.attr("id").replace("dir_",""):"",a=(t&&c('tr[data-parent-id^="'+t+'"] input[type="checkbox"]'),e.attr("data-parent-id"));c("#dir_"+a).find('input[type="checkbox"]:first')}})}),setTimeout(BackupBuddy.FileTree.sticky_headers,500),BackupBuddy.Restore.init(),BackupBuddy.File_Viewer.init(),"function"==typeof i&&i()}}))},e=function(){var e=c("#backupbuddy-data-browser > form"),t=e.attr("data-zip")?e.attr("data-zip"):BackupBuddy.Vars.get("backup_zip");t&&c.ajax({url:BackupBuddy.Vars.get("ajax.backup_info"),data:{backup:t,serial:BackupBuddy.Vars.get("backup_serial")},success:function(e){var t=c(".backup-size"),a=c(".backup-wp-version");e.success&&(void 0!==e.info.size&&t.hide().html(e.info.size).fadeIn("fast"),void 0!==e.info.wp_version&&a.hide().html(BackupBuddy.Vars.get("strings.wp_version")+" "+e.info.wp_version).fadeIn("fast"))}})};return{init:function(){m(),e()},sticky_headers:function(){var t=!1,a=!1,e=c("#backupbuddy-file-tree.panels").length;if(c(n=e?"#backupbuddy-file-tree .panel.active table":"#backupbuddy-file-tree table").length){e&&c("#backupbuddy-file-tree table").stickyTableHeaders("destroy"),c(n).stickyTableHeaders({fixedOffset:c("#wpadminbar")});var d=c(".tableFloatingHeaderOriginal")}else{var n;d=c(n=e?".panel.active .list-header":".list-header");t=d.width(),a=d.outerHeight()}if(d.length&&!d.attr("data-is-sticky")){d.attr("data-is-sticky",!0);var i=d.offset().top-c("#wpadminbar").outerHeight(),r=c("#backupbuddy-data-browser");c(window).on("scroll",function(){var e=c(window).scrollTop();i<e&&r.height()+r.offset().top-d.height()>e?(d.addClass("stuck"),t&&d.css("width",t),a&&r.css("padding-top",a)):(d.removeClass("stuck").removeAttr("style"),r.removeAttr("style"),t=t&&d.width(),a=a&&d.outerHeight())})}}}}(jQuery),jQuery(window).on("load",BackupBuddy.FileTree.init),function(d){"use strict";d.fn.serializeObject=function(){var e=this.serializeArray(),t={},a=[];return d.each(e,function(){var e;e=null!=this.value?this.value:"",0<=this.name.indexOf("[]")&&(this.name=this.name.replace("[]",""),a.push(this.name)),null!=t[this.name]&&a.includes(this.name)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(e)):t[this.name]=e}),t}}(jQuery);var pb_backupbuddy_profile_updated,backupbuddy_is_dir=function(e){return"/"===e.substr(e.length-1)},backupbuddy_trim_slashes=function(e){return e.replace(/^\/+|\/+$/g,"")},backupbuddy_basename=function(e,t){t=void 0!==t&&t;var a=new String(e);return a=(a=backupbuddy_trim_slashes(a)).substring(a.lastIndexOf("/")+1),t&&-1!=a.lastIndexOf(".")&&(a=a.substring(0,a.lastIndexOf("."))),a},backupbuddy_autoscroll=function(e){e.scrollTop(e[0].scrollHeight)},backupbuddy_oauth_window=function(e,t,a,d){var n=null!=window.screenLeft?window.screenLeft:window.screenX,i=null!=window.screenTop?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,s=r/window.screen.availWidth,u=(r-a)/2/s+n,c=(o-d)/2/s+i,l=window.open(e,t,"scrollbars=no, width="+a/s+", height="+d/s+", top="+c+", left="+u);return window.focus&&l.focus(),l};(BackupBuddy=window.BackupBuddy||{}).Modal=function(p){"use strict";var b=!1,f={},t={content:"",theme:"",mode:"",title:"",size:{},strings:{alert_button:"OK",confirm_affirmative:"OK",confirm_negative:"Cancel",prompt_button:"OK"},callbacks:{primary:function(){return y(),!0},secondary:function(){return y(),!1}},prompt:function(){return!1},prompt_default:!1,close_on_background_click:!0,close_with_esc_key:!0,disable_close_button:!1,focus_primary_button:!1},a=function(){p("body").addClass("backupbuddy-modal-open"),b.fadeIn("fast",function(){p(document).trigger("backupbuddy.modal.show")})},d=function(e){f=p.extend(!0,{},t,e),i(e),n()},n=function(){!1===b?(b=p(".backupbuddy-modal")).length?(e(),s()):b=o():(e(),s()),f.theme&&b.addClass("theme-"+f.theme),f.mode&&b.addClass("mode-"+f.mode),f.title?u(f.title):b.addClass("no-title"),f.content&&r(f.content),f.size&&c(f.size)},e=function(){b.html(""),b.removeClass("no-title"),b.removeClass(function(e,t){var a=(t.match(/(^|\s)theme-\S+/g)||[]).join(" ");return a=((a=(a.match(/(^|\s)mode-\S+/g)||[]).join(" ")).match(/(^|\s)size-\S+/g)||[]).join(" ")}),p(document).trigger("backupbuddy.modal.reset")},i=function(e){f.mode&&(void 0!==e.size&&void 0!==e.size.width||(f.size.width=500),"alert"===f.mode&&(void 0===e.close_on_background_click&&(f.close_on_background_click=!1),void 0===e.disable_close_button&&(f.disable_close_button=!0),void 0===e.focus_primary_button&&(f.focus_primary_button=!0)))},r=function(e){e instanceof jQuery||p.isArray(e)?b.find(".backupbuddy-modal-content").html("").append(e):b.find(".backupbuddy-modal-content").html(e)},o=function(){return b=p("<div />").addClass("backupbuddy-modal").hide(),p("#wpwrap").prepend(b),s(),p(document).trigger("backupbuddy.modal.create"),p(".backupbuddy-modal")},s=function(){var e=p("<div />").addClass("backupbuddy-modal-background"),t=p("<div />").addClass("backupbuddy-modal-inner"),a=p("<div />").addClass("backupbuddy-modal-content"),d=p("<h4 />").addClass("backupbuddy-modal-title"),n=p("<a />").addClass("backupbuddy-modal-close").attr("href","#close").html("&times;");if("alert"===f.mode||"confirm"===f.mode||"prompt"===f.mode){var i=p("<div />").addClass("backupbuddy-modal-dialog"),r=p("<div />").addClass("backupbuddy-modal-dialog-body"),o=p("<div />").addClass("backupbuddy-modal-dialog-actions"),s=p("<button />").addClass("button-primary");if(s.on("click",function(e){return e.preventDefault(),"function"==typeof f.prompt&&f.prompt(p(".backupbuddy-modal-prompt-input").val()),k(f.callbacks.primary)}),"alert"===f.mode)var u=s.html(f.strings.alert_button);else if("confirm"===f.mode){var c=p("<button />").addClass("button-secondary").html(f.strings.confirm_negative);c.on("click",function(e){return e.preventDefault(),k(f.callbacks.secondary)});u=[c,s.html(f.strings.confirm_affirmative)]}else if("prompt"===f.mode)u=s.html(f.strings.prompt_button);if(o.append(u),r.append(a),"prompt"===f.mode){var l=p("<input/>").addClass("backupbuddy-modal-prompt-input").attr("type","text");l.on("keyup",function(e){"Enter"===e.key&&s.trigger("click")}),"string"==typeof f.prompt_default&&f.prompt_default&&l.val(f.prompt_default),r.append(l)}i.append(r).append(o),a=i}n.on("click",function(e){e.preventDefault(),y()}),e.on("click",function(){f.close_on_background_click&&h()}),f.disable_close_button||t.append(n),t.append(d).append(a),b.append(e).append(t),p(document).trigger("backupbuddy.modal.build")},u=function(e){b.find(".backupbuddy-modal-title").html(e)},c=function(e){if(e&&"string"==typeof e)b.addClass("size-"+e);else if("object"==typeof e){if(void 0===e.width&&void 0===e.height)return;void 0!==e.width&&b.find(".backupbuddy-modal-inner").css("width",e.width),void 0!==e.height&&b.find(".backupbuddy-modal-inner").css("height",e.height)}},k=function(e,t){"function"==typeof e&&e(t)},y=function(e){p("body").removeClass("backupbuddy-modal-open"),b&&b.length&&_()?b.fadeOut("fast",function(){k(e),p(document).trigger("backupbuddy.modal.close")}):(k(e),p(document).trigger("backupbuddy.modal.close"))},l=function(){y(function(){g(),p(document).trigger("backupbuddy.modal.destroy")})},g=function(){!1!==b&&(b.length&&(b.remove(),b=!1),p(document).trigger("backupbuddy.modal.remove"))},h=function(){"confirm"===f.mode?f.callbacks.secondary():y()},m=function(){f.close_with_esc_key&&p(document).keyup(function(e){"Escape"===e.key&&h()})},_=function(){return!1!==b&&b.is(":visible")};return{init:function(){m()},open:function(e){_()||l(),d(e),p(document).trigger("backupbuddy.modal.open"),_()||a(),"prompt"===f.mode?p(".backupbuddy-modal-prompt-input").focus():f.focus_primary_button&&p(".backupbuddy-modal-dialog-actions .button-primary").focus()},close:y,content:r,destroy:l,set_size:c,find:function(e){return b.find(e)}}}(jQuery),jQuery(window).on("load",BackupBuddy.Modal.init),(BackupBuddy=window.BackupBuddy||{}).New_Backup=function(a){"use strict";pb_backupbuddy_profile_updated=function(e,t){a("#profile_title_"+e).text(t)};var e=function(){a(".profile_item_select").on("click",function(e){e.preventDefault();var t=a(this).attr("href");return t+="&after_destination="+a("#pb_backupbuddy_backup_remotedestination").val(),t+="&delete_after="+a("#pb_backupbuddy_backup_deleteafter").val(),window.location.href=t,!1})},t=function(){a("#pb_backupbuddy_afterbackupremote_box").on("change",function(){a(this).is(":checked")?tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.destination_picker")+"&callback_data=delayed_send&sending=1&action_verb=to%20send%20to&TB_iframe=1&width=640&height=455",null):(a("#pb_backupbuddy_backup_remotedestination").val(""),a("#pb_backupbuddy_backup_deleteafter").val(""),a("#pb_backupbuddy_backup_remotetitle").html(""))})},d=function(){a("body").on("thickbox:removed",function(){""===a("#pb_backupbuddy_backup_remotedestination").val()&&a("#pb_backupbuddy_afterbackupremote_box").removeAttr("checked")})},n=function(){a(".profile_settings").click(function(e){return tb_show("BackupBuddy",BackupBuddy.Vars.get("ajax.profile_settings")+"&profile="+a(this).attr("rel")+"&callback_data="+a(this).attr("rel")+"&TB_iframe=1&width=640&height=455",null),!1})},i=function(){a("#pb_backupbuddy_profileadd_plusbutton").on("click",function(e){return e.preventDefault(),a(this).hide(),a("#pb_backupbuddy_profileadd").show(),!1})};return{init:function(){e(),t(),d(),n(),i()}}}(jQuery),jQuery(window).on("load",BackupBuddy.New_Backup.init),(BackupBuddy=window.BackupBuddy||{}).Restore=function(s){"use strict";var e=!1,n=0,i=!1,t=0,a=function(){s('.backupbuddy-file-tree input[type="checkbox"]:not([data-restore-bound="true"])').each(function(){var t=s(this);t.attr("data-restore-bound","true"),t.on("change",function(){var e=t.val();t.is(":checked")?d(e):l(e)})})},d=function(e){if(!function(e){return s('#backupbuddy-restore-ui li[data-path="'+e+'"]').length}(e)){var t=o(e),a=backupbuddy_basename(e),d=backupbuddy_is_dir(e),n=s("<em/>").html(a),i=s("<li/>").attr("data-path",e).append(n),r=s("<a />").addClass("remove-file").attr("href","#"+e).html("&#10005;");r.on("click",function(e){e.preventDefault();var t=s(this).attr("href").replace("#","");s('input[value="'+t+'"]').trigger("click")}),i.append(r),d&&i.addClass("folder"),d||"backupbuddy-restore-ui"!==t.attr("id")?t.find("li.folder:last").length?t.find("li.folder:last").after(i):t.append(i):t.find("li.dir").length?t.find("li.dir").before(i):t.append(i),s(".backupbuddy-restore-list .instructions").hide(),s(".backupbuddy-restore-list .button").show(),u(),backupbuddy_autoscroll(s("#backupbuddy-restore-ui"))}},o=function(e){backupbuddy_is_dir(e),e=backupbuddy_trim_slashes(e);var t=r(e),a=s('ul[data-folder="'+t+'"]');return a.length||(a=c(t)),a},r=function(e){return backupbuddy_trim_slashes(e.replace(backupbuddy_basename(e),""))},u=function(){var e=g(),t="Restore";e&&(t+=" "+e),s(".button-restore").val(t)},c=function(e){var t=s("#backupbuddy-restore-ui"),a=s("<li />").attr("data-path",e).addClass("dir").html("<span>"+e+"</span>"),d=s("<ul />").attr("data-folder",e);return e?(a.append(d),t.append(a),d):t},l=function(e){var t=s('#backupbuddy-restore-ui li[data-path="'+e+'"]'),a=t.parent("ul");t.remove(),a.find("li").length||(a.parent("li").remove(),"backupbuddy-restore-ui"!==a.attr("id")&&a.remove()),s("#backupbuddy-restore-ui li").length||(s(".backupbuddy-restore-list .instructions").show(),s(".backupbuddy-restore-list .button").hide()),u()},p=function(){if(!e&&(e=!0,s(".backupbuddy-restore-list").length)){var t=s(".backupbuddy-restore-list"),a=t.offset().top-s("#wpadminbar").outerHeight(),d=s("#backupbuddy-data-browser");s(window).on("scroll",function(){var e=s(window).scrollTop();a<e&&d.height()+d.offset().top-t.height()>e?t.addClass("stuck"):t.removeClass("stuck")})}},b=function(){s("#backupbuddy-restore-status .abort-link").on("click",function(e){if(e.preventDefault(),i)return!1;n=1,s(".restore-current-step").html(BackupBuddy.Vars.get("strings.aborting_restore"))}),s('a[href="#abort-restore"]').on("click",function(e){e.preventDefault();var t=s(this).attr("data-restore-id");s('input[name="abort-'+t+'"]').val("1"),s('.restore-in-progress[data-restore-id="'+t+'"]').html(BackupBuddy.Vars.get("strings.aborting_restore"))})},f=function(){if(s("#backupbuddy-restore-status").hasClass("in-progress")){var e=!!s("#backupbuddy-restore-status").attr("data-restore-id")&&s("#backupbuddy-restore-status").attr("data-restore-id");k(e)}},k=function(d){return void 0===d&&(d=s("#backupbuddy-restore-status").attr("data-restore-id")),d?BackupBuddy.Restore.is_polling?(setTimeout(function(){k(d)},1e3),!1):(BackupBuddy.Restore.is_polling=!0,s(".tab.restore-backup").addClass("processing"),void s.ajax({url:BackupBuddy.Vars.get("ajax.restore_status"),data:{restore_id:d,abort:n},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(BackupBuddy.Restore.is_polling=!1,void 0!==e.success)if(e.overlapping)setTimeout(function(){k(d)},5e3);else if(e.success)!function(e){n&&(e.text=BackupBuddy.Vars.get("strings.aborting_restore")),s(".restore-current-step").html(e.text),e.locked&&(i=!0,s("#backupbuddy-restore-status .abort-link").fadeOut("fast"));var t=s(".progress-dots"),a=!1;if(e.dot&&t.find("."+e.dot).length){if(t=t.find("li"),"failed"===e.end_status)return t.find("li.loading").removeClass("loading"),t.find("li.active:last").removeClass("active").addClass("failed");t.each(function(){if(!0===a)return s(this).addClass("loading"),!1;s(this).addClass("active").removeClass("loading"),s(this).hasClass(e.dot)&&(a=!0)})}}(e.status),e.is_done?function(e){var t=s(".restore-done");if(s(".restore-status-container").css("height",s(".restore-status-container").outerHeight()),"failed"===e.end_status?(t.find(".status-complete").hide(),t.find(".status-failed").show()):"aborted"===e.end_status&&(t.find(".status-complete").hide(),t.find(".status-aborted").show()),e.error)if(t.find("p.error").length)t.find("p.error").html(e.error);else{var a=s("<p/>").addClass("error").html(e.error);t.find("h2.status-failed").after(a)}s(".tab.restore-backup").removeClass("processing"),s(".restore-active").fadeOut("fast",function(){t.fadeIn("fast",function(){s(".restore-status-container").removeAttr("style")})})}(e.status):setTimeout(function(){k(d)},3e3);else{if(void 0!==e.error)return void console.log("Restore Poll Error: "+e.error);d?y(d):console.log("Restore ID is missing.")}else y(d)},statusCode:{404:function(){y(d)},500:function(){y(d)}},error:function(e,t,a){console.log(a),y(d)}}).fail(function(e,t,a){console.log(a),y(d)})):(console.log("Missing restore ID."),!1)},y=function(e){BackupBuddy.Restore.is_polling=!1,++t<5?setTimeout(function(){k(e)},5e3):location.reload()},g=function(e){var t=(e=void 0===e?s("#backupbuddy-data-browser form").serializeObject():e).backupbuddy_restore,a=0,d=0;if(!t)return!1;s.isArray(t)||(t=new Array(t));for(var n=0;n<t.length;n++)backupbuddy_is_dir(t[n])?d++:a++;if(!a&&!d)return!1;var i="";if(d){var r=1===d?BackupBuddy.Vars.get("strings.folder"):BackupBuddy.Vars.get("strings.folders");i=d+" "+r}return a&&(i&&(i+=" & "),i+=a+" "+(r=1===a?BackupBuddy.Vars.get("strings.file"):BackupBuddy.Vars.get("strings.files"))),i},h=function(){s('a[href^="#restore-details-"]').off("click").on("click",function(e){e.preventDefault(),s(s(this).attr("href")).toggleClass("open")})},m=function(){s('#backupbuddy-data-browser form:not([data-bound="true"])').each(function(){var a=s(this);a.attr("data-bound","true"),a.on("submit",function(e){e.preventDefault();var t=s(this).serializeObject();if(!g(t))return!1;v("partial",function(){t.backupbuddy_zip=a.attr("data-zip"),t.backupbuddy_restore_type="files",t.backupbuddy_restore_tables="",s.ajax({url:BackupBuddy.Vars.get("ajax.restore"),data:t,type:"post",success:function(e){if(e.success)k(e.restore_id),s(".tab.restore-backup").addClass("processing"),s(".backupbuddy-restore-header").slideUp("fast"),s("#backupbuddy-data-browser").slideUp("fast",function(){s("#backupbuddy-data-browser").addClass("hidden"),s("#backupbuddy-restore-status").addClass("open")});else{var t=s("<p/>").addClass("error").html(e.error);BackupBuddy.Modal.open({mode:"alert",content:t})}}}),BackupBuddy.Modal.close()})})})},_=function(){s("a.restore-full-backup").off("click").on("click",function(e){e.preventDefault();function t(){var e=n||BackupBuddy.Modal.find('input[name="full-restore-type"]:checked').val();if(!e){var t=BackupBuddy.Modal.find("ul.full-restore-options"),a=BackupBuddy.Modal.find(".error");return a.length||(a=s("<p />").addClass("error"),t.before(a)),a.html(BackupBuddy.Vars.get("strings.select_restore_type_error")).show(),!1}var d="full";"db"===e?d+="_db":"files"===e&&(d+="_files"),v(d,function(){BackupBuddy.Modal.open({title:"Restoring from Backup",content:s("<p/>").css("text-align","center").html(BackupBuddy.Vars.get("strings.starting_restore"))}),s.ajax({url:BackupBuddy.Vars.get("ajax.restore"),data:{backupbuddy_zip:r,backupbuddy_restore:"*",backupbuddy_restore_tables:"*",backupbuddy_restore_destination:o,backupbuddy_restore_type:e},type:"post",success:function(e){e.success?(i=x("restore="+encodeURI(e.restore_id),i),window.location.replace(i)):e.error&&BackupBuddy.Modal.content(s("<p/>").addClass("error").css("text-align","center").html(e.error))}})})}var a=s(this),n=a.attr("data-what"),i=a.attr("href"),r=a.attr("data-zip"),o=a.attr("data-destination-id");if(n)t();else{var d=s("#backupbuddy-select-restore-type").clone();d.addClass(d.attr("id")).removeAttr("id").removeAttr("style"),d.find('input[type="radio"]:first').attr("checked","checked"),BackupBuddy.Modal.open({title:BackupBuddy.Vars.get("strings.select_restore_title"),content:d,mode:"confirm",strings:{confirm_affirmative:BackupBuddy.Vars.get("strings.continue")},callbacks:{primary:t}})}})},v=function(e,t){var a="backupbuddy-confirm-"+(e=void 0===e?"partial":e)+"-restore",d="backupbuddy-"+e+"-restore-confirm",n=s("<input />").attr("type","checkbox").attr("value","1").attr("id",a),i=[s("<div />").attr("id",d).html(BackupBuddy.Vars.get("strings.confirm_"+e+"_restore")),s("<label/>").html(BackupBuddy.Vars.get("strings.confirm_"+e+"_restore_cbx")).prepend(n)];BackupBuddy.Modal.open({title:BackupBuddy.Vars.get("strings.confirm_restore_title"),content:i,mode:"confirm",strings:{confirm_affirmative:BackupBuddy.Vars.get("strings.confirm_restore_affirmative")},callbacks:{primary:function(){if(s("#"+a).is(":checked"))return t(),!0;var e=s("#"+d).find(".error");return e.length||(e=s("<p />").addClass("error"),s("#"+d).append(e)),e.html(BackupBuddy.Vars.get("strings.confirm_restore_error")).show(),!1}}})},B=function(){s(".restore-in-progress").each(function(){var e=s(this).attr("data-restore-id");w(e)})},w=function(d){if(BackupBuddy.Restore.is_polling)return setTimeout(function(){w(d)},1e3),!1;var n=s('input[name="abort-'+d+'"]').val();BackupBuddy.Restore.is_polling=!0,s.ajax({url:BackupBuddy.Vars.get("ajax.restore_status"),data:{restore_id:d,abort:n},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(BackupBuddy.Restore.is_polling=!1,void 0!==e.success)if(e.overlapping)setTimeout(function(){w(d)},5e3);else if(e.success){var t=s('.restore-in-progress[data-restore-id="'+d+'"]');if("1"===n?t.html(BackupBuddy.Vars.get("strings.aborting_restore")):t.html(e.status.text),e.locked&&s('a[href="#abort-restore"][data-restore-id="'+d+'"]').fadeOut("fast"),e.is_done){var a=t.parents("td:first");a.html(e.status.text),a.next("td").html(e.status.html),s("tr#restore-details-"+d).find("td:first").html(e.status.details),h()}else setTimeout(function(){w(d)},3e3)}else{if(void 0!==e.error)return void console.log("Restore Poll Error: "+e.error);d?C(d):console.log("Restore ID is missing.")}else w(d)},statusCode:{404:function(){C(d)},500:function(){C(d)}},error:function(e,t,a){console.log(a),C(d)}}).fail(function(e,t,a){console.log(a),C(d)})},C=function(e){BackupBuddy.Restore.is_polling=!1,++t<5?setTimeout(function(){w(e)},5e3):location.reload()},x=function(e,t){var a="",d=t;return 0<=t.indexOf("#")&&(d=t.split("#")[0],a="#"+t.split("#")[1]),0<=d.indexOf("?")?d+="&"+e:d+="?"+e,d+a},j=function(){s(".toggle-restore-archive").on("click",function(e){e.preventDefault(),s(".backupbuddy-restore-archive").toggleClass("hidden");var t="show"===s(this).text().toLowerCase()?"Hide":"Show";s(this).text(t)})},H=function(){s(".delete-restore").on("click",function(e){e.preventDefault();var t=s(this).attr("rel"),a="true"===s(this).attr("data-corrupt")?"1":"0",d=s(this).parents("tr"),n=d.next("tr:first");BackupBuddy.Modal.open({mode:"confirm",title:"Delete Restore",content:"Are you sure you want to delete this restore? This cannot be undone!",callbacks:{primary:function(){s.ajax({url:BackupBuddy.Vars.get("ajax.restore_delete"),data:{id:t,corrupt:a},dataType:"json",success:function(e){e.success?(d.remove(),n.remove(),s(".backupbuddy-restore-archive tbody tr").length||(s(".backupbuddy-restore-archive").prev("h4").remove(),s(".backupbuddy-restore-archive").remove()),BackupBuddy.Modal.close()):BackupBuddy.Modal.open({mode:"alert",title:"Restore Delete Error",content:"There was a problem deleting the restore: "+e.error})}})}}})})};return{init:function(){_(),a(),p(),m(),h(),b(),f(),B(),j(),H()},is_polling:!1,bind_restore_buttons:_}}(jQuery),jQuery(window).on("load",BackupBuddy.Restore.init);BackupBuddy=window.BackupBuddy||{};var checkEmailNotifyErrorStatus,pb_settings_changed=!1;BackupBuddy.Settings=function(a){"use strict";var d="backupbuddy_page_pb_backupbuddy_settings",e="."+d+" ",t=function(){a("#pb_backupbuddy_email_notify_error").length&&(""===a("#pb_backupbuddy_email_notify_error").val()?(a("#pb_backupbuddy_email_notify_error").css("background-color","#FFA1A1"),a("#emailErrorNotifyHiddenAlert").show()):(a("#pb_backupbuddy_email_notify_error").css("background-color","#FFF"),a("#emailErrorNotifyHiddenAlert").hide()))},n=function(){a(".pb_backupbuddy_customize_email_scheduled_start").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_scheduled_start_row").slideToggle()}),a(".pb_backupbuddy_customize_send_finish").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_send_finish_row").slideToggle()}),a(".pb_backupbuddy_customize_email_scheduled_complete").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_scheduled_complete_row").slideToggle()}),a(".pb_backupbuddy_customize_email_error").on("click",function(e){e.preventDefault(),a(".pb_backupbuddy_customize_email_error_row").slideToggle()})},i=function(){a("#pb_backupbuddy_email_error_test").on("click",function(){return a.post(BackupBuddy.Vars.get("ajax.email_error_test"),{email:a("#pb_backupbuddy_email_notify_error").val()},function(e){"1"!=(e=a.trim(e)).charAt(0)?BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.error_testing")+":\n\n"+e}):BackupBuddy.Modal.open({mode:"alert",content:BackupBuddy.Vars.get("strings.email_test_sent")+"\n\n"+e.slice(1)})}),!1})},r=function(){a(document).on("backupbuddy.tabs.switch",function(e,t){a("body").hasClass(d)&&"#advanced"===t&&a(".nav-tab-2").trigger("click")})},o=function(){a("#pb_backupbuddy_email_notify_error").on("change",function(){t()})},s=function(){a(e+".backupbuddy-tabs .tab-controls a").on("click",function(e){!0===pb_settings_changed&&(BackupBuddy.Modal.open({mode:"alert",content:"You have made changes without saving! Be sure to save your changes!"}),pb_settings_changed=!1)}),a(e+".pb_form").on("change",function(){pb_settings_changed=!0})};return{init:function(){n(),i(),r(),t(),o(),s()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Settings.init),(BackupBuddy=window.BackupBuddy||{}).Tabs=function(d){"use strict";var e=function(){if(d(".backupbuddy-tabs").length){d(".backupbuddy-tabs .tab-controls a").on("click",function(e){e.preventDefault();var t=d(this).attr("href");"#"===t.charAt(0)?a(t):window.location.replace(t)});var e=window.location.hash;e&&a(e)}},a=function(e){var t=d('.backupbuddy-tabs .tab-controls a[href$="'+e+'"]').parent("li"),a=d(e);t.length&&a.length&&(d(".backupbuddy-tabs .tab-controls .active").removeClass("active"),t.addClass("active"),d(".backupbuddy-tabs .tab-contents.active").removeClass("active"),a.addClass("active"),d(document).trigger("backupbuddy.tabs.switch",e),history.pushState?history.pushState(null,null,e):window.location.hash=e)};return{init:function(){e()}}}(jQuery),jQuery(window).on("load",BackupBuddy.Tabs.init),(BackupBuddy=window.BackupBuddy||{}).Vars=function(){"use strict";var n=function(e){return void 0!==backupbuddy_vars.ajax_base&&backupbuddy_vars.ajax_base+e};return{get:function(e){if("undefined"==typeof backupbuddy_vars)return!1;for(var t=e,a=backupbuddy_vars,d=!1;0<=t.indexOf(".");){d=t.split(".")[0];t=e.replace(d+".",""),void 0!==a[d]&&(a=a[d])}return void 0===a[t]?"ajax"===d&&n(t):a[t]},get_ajax_url:n}}(jQuery);